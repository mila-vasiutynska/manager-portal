{
  "gitSyncId": "6996e116302bdb353697be72_fe755440-4a4c-448c-b514-58134b0c2c60",
  "id": "Dashboard_q_set_approved",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH req AS (\n\tSELECT request_id, emp_id, leave_type, total_hours\n\tFROM leave_requests\n\tWHERE request_id = {{ this.params.request_id }}::bigint\n\tAND status = 'PENDING'\n),\nupd AS (\n\tUPDATE leave_requests\n\tSET \n\tstatus = 'APPROVED',\n\tapproved_by = {{appsmith.store.full_name}},\n\tapproved_at = now()\n\tWHERE request_id = (SELECT request_id FROM req)\n\tRETURNING request_id, emp_id, leave_type, total_hours\n),\nbal AS (\n\tUPDATE leave_balances b\n\tSET\n\tannual_hours = CASE\n\tWHEN (SELECT leave_type FROM upd) = 'ANNUAL' THEN b.annual_hours - (SELECT total_hours FROM upd)\n\tELSE b.annual_hours\n\tEND,\n\tsick_hours = CASE\n\tWHEN (SELECT leave_type FROM upd) = 'SICK' THEN b.sick_hours - (SELECT total_hours FROM upd)\n\tELSE b.sick_hours\n\tEND\n\tWHERE b.emp_id = (SELECT emp_id FROM upd)\n\tRETURNING b.emp_id\n)\nSELECT request_id FROM upd;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "ERP_mockUP",
      "isAutoGenerated": false,
      "name": "ERP_mockUP",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "q_set_approved",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}